# [LCR 039. 柱状图中最大的矩形](https://leetcode.cn/problems/0ynMMM/)



```java
class Solution {
    public int largestRectangleArea(int[] heights) {
        // 单调栈解决，向右扩展，栈内保存单调柱形，当无法单调时会开始结算，结算向右结算
        Stack<Integer> poSt = new Stack<>();
        // 哨兵
        poSt.push(-1);
        int maxS = 0; 
        for(int i = 0; i <= heights.length; i ++){
            int num;
            if(i == heights.length){
                //添加哨兵
                num = 0;
            }
            else{
                num = heights[i];
            }
            // 开始结算
            while(poSt.peek()!= -1 && num < heights[poSt.peek()]){
                int j = poSt.pop();
                int h = heights[j];
                int w = i - poSt.peek() - 1;
                int S = h*w;
                if(maxS < S){
                    maxS = S;
                }
            }
            poSt.push(i);
        }
        return maxS;
    }
}
```

让我们用 `[2, 1, 2]` 这个例子来一步步分析

**初始设置：**
- `heights = [2, 1, 2]`
- 添加哨兵：`heights= [2, 1, 2, 0]`
- `stack = [-1]` (栈底哨兵)
- `maxS = 0`

**i=0 (高度=2)**

```
stack: [-1] (高度: 哨兵)
当前: i=0, 高度=2
2 > 哨兵高度，直接压入
stack: [-1, 0]
```

**i=1 (高度=1)**
```
stack: [-1, 0] (高度: 哨兵, 2)
当前: i=1, 高度=1
1 < 2 → 弹出栈顶(索引0，高度2)
计算面积：高度=2，宽度=1 - (-1) - 1 = 1，面积=2
maxS = max(0, 2) = 2

stack: [-1]
当前: i=1, 高度=1
1 > 哨兵高度，压入
stack: [-1, 1]
```

**i=2 (高度=2)**
```
stack: [-1, 1] (高度: 哨兵, 1)
当前: i=2, 高度=2
2 > 1，直接压入
stack: [-1, 1, 2]
```

**i=3 (哨兵高度=0)**
```
stack: [-1, 1, 2] (高度: 哨兵, 1, 2)
当前: i=3, 高度=0
0 < 2 → 弹出栈顶(索引2，高度2)
计算面积：高度=2，宽度=3 - 1 - 1 = 1，面积=2
maxS = max(2, 2) = 2

stack: [-1, 1] (高度: 哨兵, 1)
0 < 1 → 弹出栈顶(索引1，高度1)
计算面积：高度=1，宽度=3 - (-1) - 1 = 3，面积=3
maxS = max(2, 3) = 3

stack: [-1]
```

**最终结果：maxS = 3**

## 为什么面积是3？

让我们验证一下：
- 整个柱状图：`[2, 1, 2]`
- 最大矩形：以高度1为高，宽度为3（覆盖所有柱子）
- 面积 = 1 × 3 = 3 ✓

## 关键理解点

**为什么在 i=1 时弹出索引0？**

- 因为高度1 < 高度2，说明索引0的柱子（高度2）的右边界找到了（就是i=1）
- 左边界是栈顶的下一个元素（-1）
- 宽度 = 1 - (-1) - 1 = 1

**为什么在 i=3 时弹出索引1？**

- 因为哨兵高度0 < 高度1，说明索引1的柱子（高度1）的右边界找到了（就是i=3）
- 左边界是栈顶的下一个元素（-1）
- 宽度 = 3 - (-1) - 1 = 3

## 重要规则

**单调栈的处理规则：**
1. 当 `当前高度 >= 栈顶高度`：直接压入
2. 当 `当前高度 < 栈顶高度`：弹出栈顶并计算面积
3. **注意**：`>=` 的情况直接压入，`<` 的情况触发计算
